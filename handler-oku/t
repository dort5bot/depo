--SON HALÄ°---
* buy/hodl/sel sinyali
* BTC yada btc yazÄ±ldÄ±ÄŸÄ±nda sonuÃ§ Ã¼retsin
* raporlar usdt paritesine gÃ¶re olsun, USDT gÃ¶stermesin
*

Komut	Parametre	Anlam / AmaÃ§	AÃ§Ä±klama
/t	(boÅŸ)	Genel gÃ¶rÃ¼nÃ¼m (default)	default coinâ€™in Ã¶zet analizi
/t <n>	Ã¶rn: /t 20	Hacimli ilk n coin	Hacimli ilk n coinâ€™in piyasa genel gÃ¶rÃ¼nÃ¼mÃ¼
/t <sembol>	Ã¶rn: /t bnb	Tek coin analizi	Belirtilen coinâ€™in detaylÄ± kompozit analizi
/tt	(boÅŸ)	Top Scan (default sayÄ±da)	VarsayÄ±lan sayÄ±da  en iyi alÄ±m fÄ±rsatlarÄ±nÄ± gÃ¶sterir
/tt <n>	Ã¶rn: /tt 10	Top Scan n adet	n tane  en iyi alÄ±m fÄ±rsatlarÄ±nÄ± gÃ¶sterir
/tv
/tm	(boÅŸ)	Market Health	Genel piyasa saÄŸlÄ±ÄŸÄ± (MMI, ADI, SSP)
/tp	(boÅŸ)	Top Performers	default sayÄ±da En yÃ¼ksek alÄ±m potansiyeline sahip coinler
/tp <n>	/tp 20	Top Performers	20 tane En yÃ¼ksek alÄ±m potansiyeline sahip coinler
/tf	(boÅŸ)	Capital Flow	Coinâ€™lere giren/Ã§Ä±kan sermaye yÃ¶nÃ¼ (inflow/outflow)
/tf <sembol>	Ã¶rn: /tf btc	Capital Flow	belirtilen Coinâ€™lere giren/Ã§Ä±kan sermaye yÃ¶nÃ¼ (inflow/outflow)
/ta	(boÅŸ)	Anomaly / Alert Map	Piyasadaki fÄ±rsat ve anomalileri gÃ¶sterir


+
ğŸ¯ **KULLANIM SENARYOLARI:
/tv KullanacaÄŸÄ±n Zaman:
"Piyasa genel olarak nasÄ±l?"
"Hangi coin'ler ÅŸu anda popÃ¼ler?"
"Market sentiment nedir?"
"FarklÄ± coin'leri karÅŸÄ±laÅŸtÄ±rmak istiyorum"

/tt KullanacaÄŸÄ±n Zaman:
"Hemen alÄ±m yapmak istiyorum, en iyi fÄ±rsatlar neler?"
"Sadece alÄ±m sinyali veren coin'leri gÃ¶rmek istiyorum"
"PortfÃ¶yÃ¼me eklemek iÃ§in coin arÄ±yorum"
---



revize---
*****
ğŸ“Š Market Scan (4h, mode=config)
<SYMBOL>: Î±={score}| <regime_label> (<regime_score>) <kalman_arrow> corr=<correlation>

Ã¶rnek
ğŸ“Š Market Scan (4h, mode=config)
BTC: Î±=0.13 range(0.03) â†“ corr=1.0
ARPA: Î±=0.12  range (0.31) â†‘ corr=0.27






Kodunuz bir Telegram bot komutu (`/t`) iÃ§in teknik analiz (TA) iÅŸlevi gÃ¶rÃ¼yor ve iki temel rapor tÃ¼rÃ¼ Ã¼retiyor. Bu raporlar, kripto para piyasasÄ± taramasÄ± ve belirli bir coin analizine dair verileri iÃ§eriyor.

AÅŸaÄŸÄ±da bu **rapor formatlarÄ±nÄ±** iki baÅŸlÄ±k altÄ±nda detaylandÄ±rÄ±yorum:

---

## ğŸ“Œ 1. **Market Scan Rapor FormatÄ±** (`/t`, `/t all`, `/t 10` gibi)

Bu mod, ya configâ€™teki sembolleri tarar, ya en yÃ¼ksek hacimli coin'leri (`topN`), ya da tÃ¼m USDT paritelerini.

### ğŸ“ Format:

```
ğŸ“Š Market Scan (4h, mode={mode})
<SYMBOL>: Î±={score} [<SIGNAL>] | Rejim={regime_label}
```

### ğŸ”¸ Ã–rnek:

```
ğŸ“Š Market Scan (4h, mode=top10)
BTCUSDT: Î±=0.64 [LONG] | Rejim=trend
ETHUSDT: Î±=-0.48 [FLAT] | Rejim=range
XRPUSDT: Î±=-0.92 [SHORT] | Rejim=crash
```

### ğŸ§© AÃ§Ä±klamalar:

* `Î±`: Alpha skoru, teknik analiz sonucu Ã§Ä±kan sinyalin kuvveti.
* `[LONG | SHORT | FLAT]`: Pozisyon Ã¶nerisi (al/sat/bekle).
* `Rejim`: Piyasa durumu ("trend", "range", "crash").

---

## ğŸ“Œ 2. **Tek Coin Analiz Raporu** (`/t BTC`, `/t ETH 8` gibi)

Belirli bir coin iÃ§in detaylÄ± analiz sonucu verir. BTC ile kÄ±yaslamalÄ± `lead-lag`, `entropy`, `kalman trendi` gibi geliÅŸmiÅŸ veriler iÃ§erir.

### ğŸ“ Format:

```
ğŸ” <COIN> (<hours>h)
Î±_skor: <score> â†’ <SIGNAL>
Rejim: <regime_label> (<regime_score>)
Entropy: <entropy_score>
Kalman eÄŸilim: <kalman_arrow>
Leadâ€“Lag (BTC): <lag> bar | corr=<correlation>
```

### ğŸ”¸ Ã–rnek:

```
ğŸ” SOLUSDT (6h)
Î±_skor: 0.87 â†’ LONG
Rejim: trend (0.72)
Entropy: 0.41
Kalman eÄŸilim: â†‘
Leadâ€“Lag (BTC): 3 bar | corr=0.78
```

### ğŸ§© AÃ§Ä±klamalar:

* `Î±_skor`: Teknik analiz sinyal gÃ¼cÃ¼.
* `Rejim`: Trend tanÄ±mlayÄ±cÄ± skor ve etiketi.
* `Entropy`: Belirsizlik Ã¶lÃ§Ã¼sÃ¼.
* `Kalman eÄŸilim`: Fiyat eÄŸilimi (â†‘, â†“, â†’).
* `Leadâ€“Lag`: BTC'ye gÃ¶re gecikme (kaÃ§ bar), korelasyon deÄŸeri.

---

## ğŸ¯ Hangi Komut Ne Yapar?

| Komut      | AÃ§Ä±klama                               |
| ---------- | -------------------------------------- |
| `/t`       | Config iÃ§indeki coin'leri tarar        |
| `/t all`   | TÃ¼m USDT Ã§iftlerini tarar              |
| `/t 10`    | Hacme gÃ¶re ilk 10 coini tarar          |
| `/t BTC`   | Sadece BTC analizi (varsayÄ±lan 4 saat) |
| `/t ETH 8` | ETH analizi, son 8 saatlik veri ile    |


---
---
---
---
---
Ã–zet: Trend â†’ Risk â†’ Volatility â†’ Sentiment sÄ±rasÄ±yla Ã¶ncelikli. Regime classification en kritik! 
2. KRÄ°TÄ°K METRÄ°K GRUPLARI
A. TREND & MOMENTUM (En Ã–nemli)
Trend_Strength_Composite â†’ Ana trend yÃ¶nÃ¼
Momentum_Composite â†’ Hareket gÃ¼cÃ¼
Market_Regime â†’ Pazar rejimi

B. RISK & VOLATILITY
Volatility_Composite â†’ OynaklÄ±k seviyesi
Risk_Composite â†’ Risk durumu
Max_Drawdown â†’ Maksimum dÃ¼ÅŸÃ¼ÅŸ

C. SENTIMENT & ON-CHAIN
Funding_Rate â†’ TÃ¼rev piyasa sentiment
OI_Change_Rate â†’ Pozisyon deÄŸiÅŸimi
exchange_netflow â†’ Borsa akÄ±ÅŸlarÄ±

Ã¶rnek:
# Ã–rnek Ã§Ä±ktÄ±:
coin       trend    momentum  vola    risk    sentiment  regime        score
BTC        â†— 0.72   â†— 0.68    â†— 0.45  â†— 0.38  â†˜ -0.22   BULL_HIGH_VOL  â†— 0.40
ETH        â†— 0.64   â†’ 0.52    â†— 0.51  â†— 0.41   â†’ 0.08   BULL_MED_VOL   â†— 0.43
BNB        â†’ 0.31   â†˜ -0.18   â†— 0.62  â†— 0.55  â†˜ -0.35   NEUTRAL_HIGH_VOL â†’ 0.19

# Alarm Metrikleri:
coin       liq_risk   vol_spike  sentiment  regime_change
BTC        â†— 0.68     â†— 0.82     â†˜ -0.45    âš ï¸ HIGH_VOL
ETH        â†’ 0.41     â†— 0.71     â†’ 0.12     âœ… STABLE
BNB        â†— 0.75     â†— 0.88     â†˜ -0.62    ğŸ”¥ BEAR_HIGH_VOL


# Ã–rnek: BTC Pozisyon Analizi
BTC Metrics:
trend: â†— 0.72 (GÃœÃ‡LÃœ BULL)
momentum: â†— 0.68 (YUKARI)
volatility: â†— 0.45 (ORTA)
risk: â†— 0.38 (DÃœÅÃœK RÄ°SK)  
sentiment: â†˜ -0.22 (HAFÄ°F BEAR)
regime: BULL_HIGH_VOL

ğŸ“ POZÄ°SYON: STRONG BUY âœ…
---
---
---


## âœ… performans test--

@router.message(Command("agg_status"))
async def cmd_agg_status(message: Message):
    """
    /agg_status
    -> Aggregator'Ä±n health & performance bilgilerini dÃ¶ner.
    """
    agg: AnalysisAggregator = await get_aggregator()
    try:
        healthy, details = await agg.comprehensive_health_check()
        perf = agg.get_performance_metrics()
        lines = [f"âœ… Aggregator health: {'OK' if healthy else 'PROBLEM'}"]
        for k, v in details.items():
            lines.append(f"â€¢ {k}: {v}")
        lines.append("Performance:")
        lines.append(f"â€¢ total_executions: {perf.get('total_executions')}")
        lines.append(f"â€¢ avg_exec_time: {perf.get('average_execution_time'):.3f}s")
        lines.append(f"â€¢ cache_hits: {perf.get('cache_hits')}  cache_misses: {perf.get('cache_misses')}")
        await message.answer("\n".join(lines))
    except Exception as e:
        logger.exception("agg_status error: %s", e)
        await message.answer(f"âŒ Aggregator status alÄ±namadÄ±: {e}")

# Extra: simple ping command in this router (useful for health checks)
@router.message(Command("analysis_ping"))
async def cmd_ping(message: Message):
    await message.answer("pong â€” analysis handler alive âœ…")



