# schemas/metrics_sentiment.yaml
meta:
  version: "2025.1"
  maintainer: "ysf-bot-framework"
  last_updated: "2025-10-28"
  description: "Derivatives market sentiment and positioning metrics."

metrics:

  Funding_Rate:
    category: "sentiment"
    description: "Rolling mean funding rate; indicates long/short bias."
    formula: "Funding = mean(FundingRates, window=8)"
    input: "funding_rate_series"
    output: "float_series"

  Open_Interest:
    category: "exposure"
    description: "Total notional open positions in futures market."
    formula: "OI = Σ(Open Positions)"
    input: "open_interest_series"
    output: "float_series"

  Long_Short_Ratio:
    category: "positioning"
    description: "Ratio of long vs short positions."
    formula: "LSR = Long / Short"
    input: "long_short_positions"
    output: "float_series"

  OI_Change_Rate:
    category: "exposure"
    description: "Rate of change in open interest."
    formula: "ΔOI% = (OI_t - OI_t-n) / OI_t-n"
    parameters:
      - name: window
        type: int
        default: 4
    input: "open_interest_series"
    output: "float_series"

  Funding_Rate_Skew:
    category: "leverage_bias"
    description: "Difference in funding between longs and shorts."
    formula: "Skew = Funding_Long - Funding_Short"
    input: "funding_pair"
    output: "float_series"

  Volume_Imbalance:
    category: "order_flow"
    description: "Buy vs sell volume imbalance."
    formula: "Imb = (Buy - Sell) / (Buy + Sell)"
    input: "trade_volume_pair"
    output: "float_series"

  Liquidation_Heat:
    category: "liquidation"
    description: "Rolling mean of long and short liquidations (market stress)."
    formula: "Heat = MA(Long + Short, window=24)"
    parameters:
      - name: window
        type: int
        default: 24
    input: "liquidation_volume_series"
    output: "float_series"

  OI_Delta_Divergence:
    category: "divergence"
    description: "Divergence between open interest and price delta."
    formula: "Divergence = ΔOI * sign(ΔPrice)"
    input: "oi_price_delta"
    output: "float_series"

  Volatility_Skew:
    category: "options_market"
    description: "Difference between call and put implied volatilities."
    formula: "VolSkew = IV_Call - IV_Put"
    input: "options_iv_series"
    output: "float_series"

  Deriv_Sentiment_Score:
    category: "composite"
    description: "Composite sentiment index combining multiple derivatives metrics."
    formula: "Score = 0.2*Funding + 0.15*LSR + 0.15*ΔOI + 0.1*Skew + 0.1*VolImb + 0.3*log(OI)"
    input: "aggregated_derivative_metrics"
    output: "float_series"


  OI_Price_Corr:
    category: "divergence"
    description: "Rolling correlation between Open Interest and Price movements."
    formula: "Corr = correlation(ΔOI, ΔPrice, window=20)"
    parameters:
      - name: window
        type: int
        default: 20
    input: "oi_price_series"
    output: "float_series"

  Position_Building:
    category: "positioning"
    description: "Detects position accumulation/distribution patterns."
    formula: "Build_Score = ΔOI * sign(ΔPrice)"
    parameters:
      - name: window
        type: int
        default: 10
    input: "oi_price_series"
    output: "float_series"

  Futures_Volume_Analysis:
    category: "order_flow"
    description: "Futures volume analysis relative to spot market."
    formula: "Futures_Ratio = Futures_Volume / Spot_Volume"
    parameters:
      - name: window
        type: int
        default: 10
    input: "volume_pair_series"
    output: "float_series"

  Funding_Rate_Premium:
    category: "sentiment"
    description: "Funding rate premium relative to historical average."
    formula: "Premium = Funding_Current - Funding_MA"
    parameters:
      - name: window
        type: int
        default: 168
    input: "funding_rate_series"
    output: "float_series"

  Funding_Momentum:
    category: "sentiment"
    description: "Momentum of funding rate changes."
    formula: "Momentum = MA(ΔFunding, window=12)"
    parameters:
      - name: window
        type: int
        default: 12
    input: "funding_rate_series"
    output: "float_series"

  Open_Interest_Trend:
    category: "exposure"
    description: "Linear trend direction of Open Interest."
    formula: "Trend = slope(OI, window=20)"
    parameters:
      - name: window
        type: int
        default: 20
    input: "open_interest_series"
    output: "float_series"

  Funding_Rate_Trend:
    category: "sentiment"
    description: "Linear trend direction of funding rates."
    formula: "Trend = slope(Funding, window=20)"
    parameters:
      - name: window
        type: int
        default: 20
    input: "funding_rate_series"
    output: "float_series"

  OI_Momentum:
    category: "exposure"
    description: "Acceleration in Open Interest changes."
    formula: "Momentum = MA(ΔOI%, window=7)"
    parameters:
      - name: window
        type: int
        default: 7
    input: "open_interest_series"
    output: "float_series"

  Long_Short_Imbalance:
    category: "positioning"
    description: "Normalized imbalance between long and short positions."
    formula: "Imbalance = (Long - Short) / (Long + Short)"
    input: "long_short_positions"
    output: "float_series"